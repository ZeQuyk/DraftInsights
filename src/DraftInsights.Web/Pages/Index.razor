@page "/"
@using DraftInsights.Core.Models;

@inject DraftInsights.Core.Services.ILotterySimulatorService LotteryService;

<PageTitle>Draft lottery simulator</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Draft lottery simulator</MudText>
<MudButton OnClick="SimulateDraftAsync">Simulate</MudButton>
<MudButton OnClick="ResetDraftAsync">Reset</MudButton>
<MudTable Items="@draftPositions" T="DraftPosition">
    <HeaderContent>
        <MudTh>Position</MudTh>
        <MudTh>Team</MudTh>
        <MudTh>Record</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd>
            <MudGrid>
                <MudItem xs="6">
                    <MudText>
                        @context.Position
                    </MudText>
                </MudItem>
                <MudItem xs="6">
                    @if (context.PositionDifference > 0)
                    {
                        <MudText Color="Color.Success">+@context.PositionDifference</MudText>
                    }
                    else if (context.PositionDifference < 0)
                    {
                        <MudText Color="Color.Error">@context.PositionDifference</MudText>
                    }
                </MudItem>               
            </MudGrid>           
        </MudTd>
        <MudTd>@context.TeamRecord.Team!.Name</MudTd>
        <MudTd>@context.TeamRecord.LeagueRecord!.ToString()</MudTd>
    </RowTemplate>
</MudTable>

@code {
    private List<DraftPosition> draftPositions = new List<DraftPosition>();

    protected async override Task OnInitializedAsync()
    {
        await ResetDraftAsync();

        await base.OnInitializedAsync();
    }

    private async Task SimulateDraftAsync()
    {
        draftPositions = await LotteryService.ComputeDraftOrderAsync();
    }

    private async Task ResetDraftAsync()
    {
        draftPositions = await LotteryService.GetInitialDraftOrderAsync();
    }
}